#!/bin/sh
set -e
exec 1>/dev/null 2>&1

pgrep pulseaudio && {
    vol=$(pamixer --get-volume) || true
    test $vol -eq 100 -a "$1" = + -o $vol -eq 0 -a "$1" = - || vol=$((vol $1 5))
    pamixer --set-volume $vol
} || {
    amixer sget Speaker | grep -q "\[on" && {
        vol=$(amixer sset Speaker 5%$1 | awk 'END{print $5}')
    } || {
        vol=$(amixer sset Headphone 5%$1 | awk 'END{print $5}')
    }
}

pgrep -a -f i3mon.py &>/dev/null && {
    xdotool search --onlyvisible --class i3bar || {
        i3-msg bar hidden_state show
        (sleep 3; i3-msg bar hidden_state hide) &
    }
    printf "%s\0002" "â™¬ $vol">/tmp/i3.fifo
}
