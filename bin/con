#!/bin/sh
set -eu

d=$HOME/x/con
test -n "${1-}" || {
    find $d -printf "%P "
    echo
    exit
}

! test "$1" = "add" || {
    test -z "${2##/*}" && p=$2 || p=$PWD/$2
    exec ln -s "$p" "$d/${3-}"
}

file="$d/$1"
args=$d/$(basename "$1").args
shift

test $# -eq 0 || rm $args
{ cat $args; for arg; do printf "%s\000" "$arg"; done; } |
    tee $args | xargs -0 mpv $file
