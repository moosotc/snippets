#!/bin/sh
set -e
. asroot
modprobe -r kvm-intel kvm pcspkr applesmc iwlmvm iwlwifi \
         mac80211 cfg80211 btusb btbcm btintel btrtl bluetooth || true

tee() {
    el=".."; test -n "$2" || el="  "
    printf "%60s%s = " "$1" "$el"
    command tee $*
}

echo 1 | tee /sys/module/snd_hda_intel/parameters/power_save
echo 1 | tee /sys/bus/usb/devices/*/power/autosuspend
echo auto | tee /sys/bus/pci/devices/*/ata*/power/control
echo auto | tee /sys/bus/pci/devices/**/power/control
echo auto | tee /sys/bus/usb/devices/**/power/control
echo auto | tee /sys/devices/**/power/control
echo 0 | tee /proc/sys/kernel/nmi_watchdog
echo min_power | tee /sys/class/scsi_host/**/link_power_management_policy
echo 1500 | tee /proc/sys/vm/dirty_expire_centisecs
exit

# hmm?
echo 'med_power_with_dipm' | \
    tee /sys/class/scsi_host/**/link_power_management_policy
ethtool -s eno1 wol d
