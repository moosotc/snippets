#!/bin/sh
set -e

test "$(id -u)" != "0" && exec sudo ${DISPLAY:+-A} "$0" "$@"

echo '1' >/sys/module/snd_hda_intel/parameters/power_save
echo 'min_power' >/sys/class/scsi_host/host0/link_power_management_policy
echo '1' | tee >/dev/null /sys/bus/usb/devices/*/power/autosuspend
echo 'auto' | tee >/dev/null /sys/devices/**/power/control
echo 'auto' | tee >/dev/null /sys/bus/pci/devices/**/power/control
for f in $(find /sys/devices -name product -type f \
                -exec grep -l '\(Keyboard\|Mouse\)' {} \;); do
    echo '0' >$(dirname $f)/power/autosuspend || echo "Hum $f"
done

ethtool -s enp3s0f0 wol d
echo '0' >/sys/class/rtc/rtc0/wakealarm
date -u --date '+1 sec' +%s >/sys/class/rtc/rtc0/wakealarm
echo 'mem' >/sys/power/state
