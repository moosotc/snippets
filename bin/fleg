#!/bin/sh
set -eu

font=$HOME/x/fnt/LastResort.ttf
! test -r $font || export LLPP_FALLBACK_FONT=$font

html=$HOME/.cache/llpp/fonts/leg.html
command -v shuf &>/dev/null || shuf() { cat; }

sep='&nbsp;'

all="
****
1oop
ho1e
3ДС
ЗДС
S9
.
'
gq
qg
-~
~-
--
~~
'
''
\"
'\"
\"'
\"\"
l
I
lI
Il
1l
l1
3S1OlЗ0\$S3D3O1D1O
Star
\$tar
"

perm()  {
    printf "$1 "
    echo "$2" | shuf | tr -d '[[:space:]]'
}

text() {
    cat <<EOF
<br/>кирилица $1<hr>
<pre style="font-size: ${1}pt;">
\$S\$s\$5hmmаммаhm<i/>mb8B0dy кирилица $1<hr>
IĪ lI 1l Il l1 3З S9 O0o 0︀ composed-0̸ ʘ 0
cf https://en.wikipedia.org/wiki/Slashed_zero
$(perm "l" "$all")
| I | not bar        | with crossbars Ι
| l | not bar        | with retroflex hook (ɭ Ɩ Ꙇ ꙇ Ɩ)
| 0 | not Oh         | ʘ 0
| 1 | not bar        | with baseline bar
| 3 | flat top       | ӡ
| З | non-flat top   | ?

2ʒ4
2Ȝ4
2Ӡ4
2ᴣ4
2ʒ4
0123
3210
1032
3504

illiad help malc clam LATIN SMALL LETTER L
iɭɭiad heɭp maɭc cɭam LATIN SMALL LETTER L WITH RETROFLEX HOOK
iƖƖiad heƖp maƖc cƖam LATIN CAPITAL LETTER IOTA
iɩɩiad heɩp maɩc cɩam LATIN SMALL LETTER IOTA
iꙆꙆiad heꙆp maꙆc cꙆam CYRILLIC CAPITAL LETTER IOTAA
iꙇꙇiad heꙇp maꙇc cꙇam CYRILLIC SMALL LETTER IOTA
ajs
</pre>
EOF
}

maketext() {
    # https://github.com/react-boilerplate/react-boilerplate/issues/1340
    cat >"$html" <<EOF
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
 "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html>
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <title>$1</title>
    <style type="text/css">
      @font-face { font-family: moo; src: url('$1'); }
      pre { font-family: moo; }
    </style>
  &quot;$({ fc-scan -f '%{family}' "$1" | head -30c; } || file "$1")&quot;
  $(basename "$1")
  </head>
<body>
        <pre>3З ʒȜӠᴣʒʓ oO0ѲØ 1o1O101Ѳ1Ø1∅øØo0ʘ OCD</pre>
EOF
    for size in 8 10 6 5 4; do
        text $size >>"$html"
    done
    cat >>"$html" <<EOF
    <br/>
    $(fc-scan -f '%{fullname} %{style} %{slant} %{file} %{fontversion} %{capability}' "$1" || file "$1")
    <br>$1
  </body>
</html>
EOF
}

test -r "$1"
maketext "$1"
exec llpp -origin $1 $html
