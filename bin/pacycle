#!/bin/sh
set -e
exec 1>/dev/null 2>&1

pgrep pulseaudio || {
    amixer set Speaker toggle | grep -q '\[on\]' && name="ðŸ”‰" || name="ðŸŽ§"
    printf "$name %s\0003" >/tmp/i3.fifo
    exit 0
}
port=analog-output-speaker
pacmd list-sinks | grep "active.*port.*headph" || port=analog-output-headphones
name=${port##analog-output-}
test $name = "headphones" && name="ðŸŽ§ $name" || name="ðŸ”‰ $name"
pacmd set-sink-port alsa_output.pci-0000_00_1b.0.analog-stereo $port
vol=$(pamixer --get-volume) || true
xdotool search --onlyvisible --class i3bar || {
    i3-msg bar hidden_state show
    (sleep 3; i3-msg bar hidden_state hide) &
}
printf "$name $vol%%\0003" >/tmp/i3.fifo
