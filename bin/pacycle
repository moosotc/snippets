#!/bin/sh

# based on http://askubuntu.com/questions/71863\
# /how-to-change-pulseaudio-sink-with-pacmd-set-default-sink-during-playback
set -e
exec 1>&2 2>/dev/null
xdotool search --onlyvisible i3bar || {
    i3-msg bar hidden_state show
    (sleep 3; i3-msg bar hidden_state hide) &
}

# this logic is binary, so the name is misleasing it doesn't cycle it
# toggles between two "upmost" sinks

sink=$(pacmd list-sinks | awk '/[^\*] index: / {print $2}')
pacmd set-default-sink $sink
desc=$(pacmd list-sinks | awk '/\* index/{x=1}/descr/{if(x){x=0;print$0;}}' \
              | cut -d= -f 2)
printf "$(eval printf "$desc")\x003" >/tmp/i3.fifo
pacmd list-sink-inputs | grep index | while read line
do
    set -- $line
    pacmd move-sink-input $2 $sink
done
