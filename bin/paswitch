#!/bin/sh
set -e

defind=$(pacmd list-sinks | awk '/\* index/ {print $3}')
ind=$((defind^1))
pacmd set-default-sink "$ind"
vol=$(pamixer --get-volume) || true
sedf() {
    sed -n '/\* index/,/description/{/descr/s/.*= "\(.*\)"/\1/p}'
}
printf "$(pacmd list-sinks | sedf) $vol%%\0003" >/tmp/i3.fifo
xdotool search --onlyvisible --class i3bar || {
    i3-msg bar mode hide
    (sleep 3; i3-msg bar mode invisible) &
}
pacmd list-sink-inputs | grep index | while read line
do
    set -- $line
    pacmd move-sink-input $2 $ind
done
