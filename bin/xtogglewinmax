#!/bin/sh
set -e

vonly="$1"
id=$(xdotool getactivewindow)
geom=$(xprop -notype -id $id MOO_GEOM)
expr >/dev/null "$geom" : ".*: .*" && {
    geom=$(xdotool getwindowgeometry --shell $id)
    eval $geom
    xprop -id $id -format MOO_GEOM 8s \
          -set MOO_GEOM "X=$X Y=$Y W=$WIDTH H=$HEIGHT"
    test -z "$vonly" && {
        xdotool getactivewindow windowsize 100% 93% windowmove 0 54
    } || {
        eval $(xdotool search --class i3bar getwindowgeometry --shell) X=$X
        xdotool getactivewindow windowsize 0 93% windowmove $X $((HEIGHT+26))
    }
} || {
    set -- $geom
    eval eval ${*:3}
    xprop -id $id -remove MOO_GEOM
    xdotool windowsize $id $W $H windowmove $id $((X-4)) $Y
}
